<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dealer360 — System Architecture & MVP Blueprint</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a2e;
            --bg-card: #16162a;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b8;
            --text-muted: #6a6a80;
            --accent: #6366f1;
            --accent-light: #818cf8;
            --accent-dark: #4f46e5;
            --green: #22c55e;
            --red: #ef4444;
            --amber: #f59e0b;
            --cyan: #06b6d4;
            --border: #2a2a40;
            --border-light: #3a3a55;
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --shadow: 0 4px 24px rgba(0, 0, 0, .4);
            --shadow-lg: 0 8px 40px rgba(0, 0, 0, .6);
            --glass: rgba(255, 255, 255, .03);
            --glass-border: rgba(255, 255, 255, .06);
        }

        html {
            scroll-behavior: smooth
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            overflow-x: hidden
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: transform .3s
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border)
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-light), var(--cyan));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent
        }

        .sidebar-header p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 1.5px
        }

        .doc-tabs {
            display: flex;
            padding: 12px;
            gap: 6px
        }

        .doc-tab {
            flex: 1;
            padding: 10px 8px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: .2s;
            font-family: inherit
        }

        .doc-tab.active {
            background: var(--accent);
            color: #fff
        }

        .doc-tab:not(.active) {
            background: var(--bg-tertiary);
            color: var(--text-secondary)
        }

        .doc-tab:not(.active):hover {
            background: var(--border);
            color: var(--text-primary)
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 8px 12px
        }

        .sidebar-nav::-webkit-scrollbar {
            width: 4px
        }

        .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px
        }

        .nav-section {
            margin-bottom: 6px
        }

        .nav-section-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            padding: 12px 12px 6px;
            font-weight: 700
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: .15s;
            cursor: pointer
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--glass);
            color: var(--text-primary)
        }

        .nav-link.active {
            border-left: 2px solid var(--accent);
            color: var(--accent-light)
        }

        .nav-link .icon {
            width: 18px;
            text-align: center;
            font-size: 14px
        }

        /* MAIN */
        .main {
            margin-left: 280px;
            min-height: 100vh
        }

        .topbar {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 15, .8);
            border-bottom: 1px solid var(--border);
            padding: 16px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px
        }

        .hamburger {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-sm);
            transition: .15s;
            flex-shrink: 0;
            line-height: 1;
            min-width: 44px;
            min-height: 44px;
            align-items: center;
            justify-content: center
        }

        .hamburger:hover {
            background: var(--glass)
        }

        .hamburger svg {
            width: 22px;
            height: 22px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none
        }

        .topbar h2 {
            font-size: 16px;
            font-weight: 700
        }

        .topbar-meta {
            display: flex;
            gap: 16px;
            align-items: center
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600
        }

        .badge-accent {
            background: rgba(99, 102, 241, .15);
            color: var(--accent-light);
            border: 1px solid rgba(99, 102, 241, .3)
        }

        .badge-green {
            background: rgba(34, 197, 94, .1);
            color: var(--green);
            border: 1px solid rgba(34, 197, 94, .2)
        }

        .content {
            padding: 40px;
            max-width: 1100px;
            width: 100%
        }

        /* SECTIONS */
        .section {
            margin-bottom: 48px;
            animation: fadeIn .4s
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .section-header {
            margin-bottom: 24px
        }

        .section-header h2 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px
        }

        .section-header h3 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px
        }

        .section-header p {
            color: var(--text-secondary);
            font-size: 14px
        }

        .section-header .label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent-light);
            font-weight: 700;
            margin-bottom: 8px;
            display: block
        }

        /* CARDS */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 16px;
            transition: .2s
        }

        .card:hover {
            border-color: var(--border-light);
            box-shadow: var(--shadow)
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .card-grid {
            display: grid;
            gap: 16px
        }

        .card-grid-2 {
            grid-template-columns: repeat(2, 1fr)
        }

        .card-grid-3 {
            grid-template-columns: repeat(3, 1fr)
        }

        /* WORKFLOW CARDS */
        .workflow-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 20px
        }

        .workflow-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: .15s
        }

        .workflow-header:hover {
            background: var(--glass)
        }

        .workflow-num {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            flex-shrink: 0
        }

        .workflow-meta {
            flex: 1
        }

        .workflow-meta h4 {
            font-size: 15px;
            font-weight: 700
        }

        .workflow-meta p {
            font-size: 12px;
            color: var(--text-muted)
        }

        .workflow-toggle {
            font-size: 20px;
            color: var(--text-muted);
            transition: .3s
        }

        .workflow-card.open .workflow-toggle {
            transform: rotate(180deg)
        }

        .workflow-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height .4s ease
        }

        .workflow-card.open .workflow-body {
            max-height: none
        }

        .workflow-content {
            padding: 0 24px 24px
        }

        .workflow-content h5 {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-light);
            margin: 16px 0 8px;
            padding-top: 16px;
            border-top: 1px solid var(--border)
        }

        .workflow-content h5:first-child {
            border-top: none;
            padding-top: 0
        }

        .workflow-content ul,
        .workflow-content ol {
            padding-left: 20px;
            margin: 8px 0
        }

        .workflow-content li {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            line-height: 1.6
        }

        .workflow-content li strong {
            color: var(--text-primary)
        }

        /* TABLES */
        .table-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 16px 0;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border)
        }

        .table-wrap table {
            margin: 0;
            border: none
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 13px;
            min-width: 480px
        }

        thead {
            background: var(--bg-tertiary)
        }

        th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .5px;
            white-space: nowrap
        }

        td {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary)
        }

        tr:hover td {
            background: var(--glass);
            color: var(--text-primary)
        }

        /* CODE */
        pre {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px;
            overflow-x: auto;
            margin: 12px 0;
            font-size: 12.5px;
            line-height: 1.6
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12.5px
        }

        :not(pre)>code {
            background: rgba(99, 102, 241, .1);
            color: var(--accent-light);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px
        }

        /* CALLOUT */
        .callout {
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            margin: 16px 0;
            font-size: 13px;
            line-height: 1.6
        }

        .callout-info {
            background: rgba(99, 102, 241, .08);
            border-left: 3px solid var(--accent);
            color: var(--text-secondary)
        }

        .callout-success {
            background: rgba(34, 197, 94, .08);
            border-left: 3px solid var(--green);
            color: var(--text-secondary)
        }

        .callout-warn {
            background: rgba(245, 158, 11, .08);
            border-left: 3px solid var(--amber);
            color: var(--text-secondary)
        }

        .callout strong {
            color: var(--text-primary)
        }

        /* STATUS DOTS */
        .status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px
        }

        .status::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%
        }

        .status-in::before {
            background: var(--green)
        }

        .status-out::before {
            background: var(--red)
        }

        .status-future::before {
            background: var(--amber)
        }

        /* PILLS */
        .pill {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin: 2px
        }

        .pill-green {
            background: rgba(34, 197, 94, .12);
            color: var(--green)
        }

        .pill-red {
            background: rgba(239, 68, 68, .12);
            color: var(--red)
        }

        .pill-amber {
            background: rgba(245, 158, 11, .12);
            color: var(--amber)
        }

        .pill-blue {
            background: rgba(6, 182, 212, .12);
            color: var(--cyan)
        }

        .pill-accent {
            background: rgba(99, 102, 241, .12);
            color: var(--accent-light)
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .7);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px
        }

        .modal-overlay.open {
            display: flex
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            max-width: 900px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg)
        }

        .modal-header {
            position: sticky;
            top: 0;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
            z-index: 1
        }

        .modal-header h3 {
            font-size: 18px;
            font-weight: 700
        }

        .modal-close {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: .15s;
            flex-shrink: 0
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary)
        }

        .modal-body {
            padding: 24px
        }

        .modal-body pre {
            font-size: 11.5px
        }

        /* TIMELINE */
        .timeline {
            position: relative;
            padding-left: 28px;
            margin: 16px 0
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 4px;
            bottom: 4px;
            width: 2px;
            background: var(--border)
        }

        .timeline-item {
            position: relative;
            padding-bottom: 16px
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent);
            border: 2px solid var(--bg-primary)
        }

        .timeline-item h5 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px
        }

        .timeline-item p {
            font-size: 13px;
            color: var(--text-secondary)
        }

        /* SIDEBAR OVERLAY (used on mobile) */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .6);
            backdrop-filter: blur(4px);
            z-index: 99;
            opacity: 0;
            pointer-events: none;
            transition: opacity .3s
        }

        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto
        }

        /* ===== RESPONSIVE: Tablet (max 1024px) ===== */
        @media(max-width:1024px) {
            .sidebar {
                width: 260px
            }

            .main {
                margin-left: 260px
            }

            .content {
                padding: 28px 24px
            }

            .section-header h2 {
                font-size: 24px
            }

            .section-header h3 {
                font-size: 20px
            }

            .card-grid-3 {
                grid-template-columns: repeat(2, 1fr)
            }

            .topbar {
                padding: 14px 24px
            }

            .topbar h2 {
                font-size: 14px
            }
        }

        /* ===== RESPONSIVE: Mobile (max 768px) ===== */
        @media(max-width:768px) {
            .sidebar {
                width: 300px;
                transform: translateX(-100%);
                box-shadow: var(--shadow-lg)
            }

            .sidebar.open {
                transform: translateX(0)
            }

            .main {
                margin-left: 0
            }

            .hamburger {
                display: flex
            }

            .content {
                padding: 20px 16px
            }

            .topbar {
                padding: 10px 16px
            }

            .topbar h2 {
                font-size: 13px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex: 1;
                min-width: 0
            }

            .topbar-meta {
                gap: 8px;
                flex-shrink: 0
            }

            .badge {
                padding: 3px 8px;
                font-size: 10px
            }

            .section-header h2 {
                font-size: 22px
            }

            .section-header h3 {
                font-size: 18px
            }

            .section-header p {
                font-size: 13px
            }

            .card {
                padding: 16px;
                border-radius: var(--radius-sm)
            }

            .card-title {
                font-size: 14px;
                flex-wrap: wrap
            }

            .card-grid-2,
            .card-grid-3 {
                grid-template-columns: 1fr
            }

            /* Workflow cards  */
            .workflow-header {
                padding: 14px 16px;
                gap: 12px
            }

            .workflow-num {
                width: 34px;
                height: 34px;
                font-size: 14px;
                border-radius: 8px
            }

            .workflow-meta h4 {
                font-size: 14px
            }

            .workflow-meta p {
                font-size: 11px
            }

            .workflow-content {
                padding: 0 16px 16px
            }

            .workflow-content li {
                font-size: 13px
            }

            .workflow-content h5 {
                font-size: 12px
            }

            /* Tables — horizontal scroll */
            table {
                min-width: 500px
            }

            th {
                padding: 10px 12px;
                font-size: 10px
            }

            td {
                padding: 8px 12px;
                font-size: 12px
            }

            /* Code blocks */
            pre {
                padding: 12px;
                font-size: 11px;
                border-radius: 6px
            }

            code {
                font-size: 11px
            }

            :not(pre)>code {
                font-size: 10.5px;
                padding: 1px 5px
            }

            /* Callouts */
            .callout {
                padding: 12px 14px;
                font-size: 12px
            }

            /* Flow diagram */
            .flow {
                gap: 3px;
                font-size: 11px
            }

            .flow-step {
                padding: 4px 10px;
                font-size: 11px
            }

            /* Section spacing */
            .section {
                margin-bottom: 32px
            }

            /* Modal full screen on mobile */
            .modal-overlay {
                padding: 0
            }

            .modal {
                max-height: 100vh;
                border-radius: 0;
                height: 100%
            }

            .modal-header {
                padding: 16px
            }

            .modal-header h3 {
                font-size: 15px
            }

            .modal-body {
                padding: 16px
            }

            .modal-body pre {
                font-size: 10.5px
            }
        }

        /* ===== RESPONSIVE: Small phones (max 400px) ===== */
        @media(max-width:400px) {
            .content {
                padding: 16px 12px
            }

            .section-header h2 {
                font-size: 19px
            }

            .section-header h3 {
                font-size: 16px
            }

            .card {
                padding: 12px;
                margin-bottom: 12px
            }

            .workflow-header {
                padding: 12px
            }

            .topbar h2 {
                font-size: 12px
            }

            .doc-tab {
                font-size: 11px;
                padding: 8px 6px
            }

            .nav-link {
                font-size: 12px;
                padding: 10px 12px
            }

            .sidebar-header {
                padding: 18px 16px
            }

            .sidebar-header h1 {
                font-size: 16px
            }
        }

        /* PAGE VISIBILITY */
        .doc-page {
            display: none
        }

        .doc-page.active {
            display: block
        }

        /* FLOW DIAGRAM */
        .flow {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
            margin: 12px 0;
            font-size: 12px
        }

        .flow-step {
            padding: 6px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-weight: 500;
            white-space: nowrap
        }

        .flow-arrow {
            color: var(--accent-light);
            font-weight: 700
        }

        /* PERMISSION GRID */
        .perm-yes {
            color: var(--green);
            font-weight: 700;
            text-align: center
        }

        .perm-no {
            color: var(--red);
            text-align: center
        }

        /* FOLDER TREE */
        .tree {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            line-height: 1.8;
            color: var(--text-secondary);
            background: var(--bg-primary);
            padding: 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            margin: 12px 0;
            overflow-x: auto
        }

        .tree .dir {
            color: var(--accent-light);
            font-weight: 600
        }

        .tree .comment {
            color: var(--text-muted)
        }
    </style>
</head>

<body>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>DEALER360</h1>
            <p>Technical Documentation</p>
        </div>
        <div class="doc-tabs">
            <button class="doc-tab active" onclick="switchDoc('arch')">Architecture</button>
            <button class="doc-tab" onclick="switchDoc('mvp')">MVP Blueprint</button>
        </div>
        <nav class="sidebar-nav" id="sidebarNav"><!-- JS populated --></nav>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <div class="main">
        <div class="topbar">
            <button class="hamburger" id="hamburgerBtn" onclick="toggleSidebar()" aria-label="Open navigation menu">
                <svg viewBox="0 0 24 24">
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>
            <h2 id="topbarTitle">System Architecture & Core Workflows</h2>
            <div class="topbar-meta">
                <span class="badge badge-accent">v2.0</span>
                <span class="badge badge-green">Feb 2026</span>
            </div>
        </div>
        <div class="content">
            <div class="doc-page active" id="page-arch">
                <div id="arch-content">

                    <!-- OVERVIEW -->
                    <div class="section" id="arch-intro">
                        <div class="section-header">
                            <span class="label">Single Source of Truth</span>
                            <h2>System Architecture & Core Workflows</h2>
                            <p>This document answers: "What does every user do, what does the system do in response, and
                                how is it all wired together?"</p>
                        </div>
                        <div class="callout callout-info"><strong>These are not pages.</strong> These are
                            <strong>behavioral sequences</strong> — what a human does, what the machine does back, and
                            what changes in the database as a result.
                        </div>
                    </div>

                    <!-- WF1 -->
                    <div class="workflow-card" id="wf-1">
                        <div class="workflow-header" onclick="toggleWorkflow(this)">
                            <div class="workflow-num">1</div>
                            <div class="workflow-meta">
                                <h4>Vehicle Discovery → Purchase Decision</h4>
                                <p>Any visitor (guest or authenticated) · Landing page or direct link</p>
                            </div>
                            <span class="workflow-toggle">▼</span>
                        </div>
                        <div class="workflow-body">
                            <div class="workflow-content">
                                <h5>What They Do</h5>
                                <ol>
                                    <li>Open the platform → see featured vehicles and the AI Valuation tool</li>
                                    <li>Search/filter by make, model, year, price range, condition</li>
                                    <li>Click a vehicle → see full detail page (specs, images, trust score, market
                                        comparison)</li>
                                    <li>Use the AI Valuation tool → input any car's make/model/year → get instant market
                                        intelligence</li>
                                    <li>If interested → click <strong>"Join Auction"</strong> or <strong>"Contact
                                            Concierge"</strong></li>
                                </ol>
                                <h5>What They See</h5>
                                <ul>
                                    <li><strong>Vehicle cards:</strong> image, make/model/year, price, trust score badge
                                        (0-100)</li>
                                    <li><strong>Detail page:</strong> gallery, specs pulled from
                                        <code>vehicle_catalog</code>, current market value vs. listing price,
                                        depreciation curve, "Buy/Hold/Sell" AI signal
                                    </li>
                                    <li><strong>AI Valuation:</strong> price breakdown across
                                        Tokunbo/Nigerian-used/brand-new, investment score (1-10), seasonal
                                        recommendation</li>
                                </ul>
                                <h5>System Changes</h5>
                                <ul>
                                    <li><code>user_interaction_embeddings</code> row created (search query, viewed
                                        vehicle) — feeds recommendation engine</li>
                                    <li>If guest → session tracked for lead capture. If valuation used → email/phone
                                        captured before showing full report</li>
                                    <li>No write to <code>vehicles</code>, <code>auctions</code>, or <code>bids</code>
                                        until authenticated action</li>
                                </ul>
                                <h5>What Can Fail</h5>
                                <ul>
                                    <li><strong>AI valuation provider timeout</strong> → show cached result or
                                        "temporarily unavailable" with retry</li>
                                    <li><strong>Vehicle no longer available</strong> → show "Sold" status, suggest
                                        similar via semantic search</li>
                                    <li><strong>Search returns zero results</strong> → show AI-recommended alternatives
                                        from embeddings</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- WF2 -->
                    <div class="workflow-card" id="wf-2">
                        <div class="workflow-header" onclick="toggleWorkflow(this)">
                            <div class="workflow-num">2</div>
                            <div class="workflow-meta">
                                <h4>Auction Participation → Winning a Vehicle</h4>
                                <p>Authenticated user with funded wallet · Vehicle detail page</p>
                            </div>
                            <span class="workflow-toggle">▼</span>
                        </div>
                        <div class="workflow-body">
                            <div class="workflow-content">
                                <h5>What They Do</h5>
                                <ol>
                                    <li>Click "Join Auction" → system checks:
                                        <code>is_authenticated? → has_kyc? → has_sufficient_funds?</code>
                                    </li>
                                    <li>If any check fails → shown the specific blocker (login, complete KYC, fund
                                        wallet)</li>
                                    <li>Enter auction room → see live bid feed, current price, time remaining, bidder
                                        count</li>
                                    <li>Place bid → enter amount (must exceed current bid + minimum increment)</li>
                                    <li>Watch real-time updates → see if outbid → place new bid or wait</li>
                                    <li>Auction ends → winner notification or "outbid" result</li>
                                </ol>
                                <h5>What They See</h5>
                                <ul>
                                    <li><strong>Pre-entry:</strong> wallet balance, maximum bidding power calculation,
                                        deposit requirement (20% of bid)</li>
                                    <li><strong>In-room:</strong> live price ticker (WebSocket), countdown timer, bid
                                        history feed, "You are winning" / "You are outbid" status</li>
                                    <li><strong>Post-auction:</strong> "Congratulations" modal with next steps OR "This
                                        auction has ended" with similar vehicles</li>
                                </ul>
                                <h5>System Changes</h5>
                                <pre><code>ON BID PLACED:
  1. Validate: user.buying_power >= (sum_of_active_winning_bids + new_bid) * 0.20
  2. Insert into `bids` (auction_id, user_id, amount, timestamp, is_platform_bid=false)
  3. Update `auctions.current_price` = new_bid_amount
  4. Broadcast via WebSocket to all connected clients in room `auction:{id}`
  5. If bid placed in last 2 minutes → extend auction by 2 minutes (anti-sniping)

ON AUCTION END:
  1. Select highest bid → set `auctions.winner_id`
  2. Lock 20% deposit from winner's wallet → insert `transactions` (type='deposit_hold')
  3. Update `auctions.status` = 'pending_settlement'
  4. Notify winner (email + SMS + in-app) with payment deadline
  5. Notify losers with "similar vehicles" recommendations

AI RESERVE PROTECTION (runs every 30 seconds during auction):
  1. If current_price &lt; reserve_price * 0.90 AND time_remaining &lt; 60 minutes
  2. AI places platform bid at current_price + minimum_increment
  3. Insert into `bids` with is_platform_bid=true
  4. Hard stop: never bid above reserve_price * 0.95</code></pre>
                                <h5>What Can Fail</h5>
                                <ul>
                                    <li><strong>Concurrent bids (race condition)</strong> → serialize with PostgreSQL
                                        <code>SELECT FOR UPDATE</code> row lock on auction row
                                    </li>
                                    <li><strong>WebSocket disconnect</strong> → client auto-reconnects, fetches latest
                                        state via REST fallback</li>
                                    <li><strong>Payment failure on deposit hold</strong> → winner has 24h to fund
                                        wallet, else auction goes to next highest bidder</li>
                                    <li><strong>User bids beyond capacity</strong> → rejected at validation step with
                                        clear error message</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- WF3 -->
                    <div class="workflow-card" id="wf-3">
                        <div class="workflow-header" onclick="toggleWorkflow(this)">
                            <div class="workflow-num">3</div>
                            <div class="workflow-meta">
                                <h4>Post-Auction Settlement → Taking Ownership</h4>
                                <p>Auction winner · "You Won" notification</p>
                            </div>
                            <span class="workflow-toggle">▼</span>
                        </div>
                        <div class="workflow-body">
                            <div class="workflow-content">
                                <h5>What They Do</h5>
                                <ol>
                                    <li>View settlement summary: vehicle details, winning bid, deposit already held,
                                        remaining balance due</li>
                                    <li>Complete payment for remaining 80% → Paystack checkout</li>
                                    <li>Choose delivery method: pickup from facility OR delivery to address (₦50,000)
                                    </li>
                                    <li>Upload required documents: ID, proof of address (for registration)</li>
                                    <li>Track progress through settlement stages</li>
                                </ol>
                                <h5>What They See</h5>
                                <ul>
                                    <li>Settlement dashboard with stages: <strong>Payment → Inspection → Documentation →
                                            Delivery</strong></li>
                                    <li>Each stage has status: pending / in-progress / completed</li>
                                    <li>Estimated completion dates per stage</li>
                                    <li>Direct chat with assigned concierge</li>
                                </ul>
                                <h5>System Changes</h5>
                                <pre><code>ON FULL PAYMENT:
  1. Convert deposit hold to confirmed payment → update `transactions`
  2. Create `service_requests` (type='post_auction_settlement', vehicle_id, user_id)
  3. Update `vehicles.status` = 'in_settlement'
  4. Update `vehicles.owner_id` = winner's user_id
  5. Assign concierge → create `concierge_tasks` (priority='high')

ON COMPLETION:
  1. Update `service_requests.status` = 'completed'
  2. Update `vehicles.status` = 'owned'
  3. Add entry to `vehicle_history` JSONB log (immutable append)
  4. Vehicle appears in user's Digital Garage</code></pre>
                                <h5>What Can Fail</h5>
                                <ul>
                                    <li><strong>Payment timeout</strong> → 24h deadline, then escalate to next bidder.
                                        Deposit forfeited (platform revenue)</li>
                                    <li><strong>Document rejection</strong> → concierge contacts user, re-upload flow
                                    </li>
                                    <li><strong>Delivery delay</strong> → tracking page shows real status, concierge
                                        proactively updates</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- WF4 -->
                    <div class="workflow-card" id="wf-4">
                        <div class="workflow-header" onclick="toggleWorkflow(this)">
                            <div class="workflow-num">4</div>
                            <div class="workflow-meta">
                                <h4>Digital Garage → Managing Owned Vehicles</h4>
                                <p>Authenticated vehicle owner · Dashboard → "My Garage"</p>
                            </div>
                            <span class="workflow-toggle">▼</span>
                        </div>
                        <div class="workflow-body">
                            <div class="workflow-content">
                                <h5>What They Do</h5>
                                <ol>
                                    <li>View all owned vehicles as cards with current market valuations</li>
                                    <li>Click a vehicle → see full ownership dashboard (history, valuation trends,
                                        service records)</li>
                                    <li>Take action: Schedule Service / Request Upgrade / List for Sale / View Insurance
                                        Options</li>
                                </ol>
                                <h5>What They See</h5>
                                <ul>
                                    <li><strong>Portfolio summary:</strong> total portfolio value, monthly change %, top
                                        performer</li>
                                    <li><strong>Per vehicle:</strong> current market value (AI-updated weekly), purchase
                                        price, ROI %, service history timeline, next recommended service</li>
                                    <li>Action buttons contextual to vehicle status</li>
                                </ul>
                                <h5>System Changes</h5>
                                <pre><code>ON GARAGE VIEW:
  1. Fetch all vehicles WHERE owner_id = user AND status IN ('owned', 'in_service')
  2. For each vehicle, fetch latest valuation from `vehicle_valuations`
  3. Fetch service history from `vehicle_history` JSONB

ON LIST FOR SALE:
  1. User sets asking price (AI suggests based on market data)
  2. Choose: Direct Sale or Auction
  3. Create `auctions` record (if auction) or `listings` record (if direct)
  4. Update `vehicles.status` = 'listed'
  5. Trigger AI imagery pipeline → generate fresh photos if older than 30 days

ON SCHEDULE SERVICE:
  1. Select service type (Maintenance, Repair, Upgrade)
  2. Create `service_requests` (type, vehicle_id, user_id, description)
  3. System matches to available partners based on type + location + rating
  4. User selects partner → quote generated → approval → execution</code></pre>
                                <h5>What Can Fail</h5>
                                <ul>
                                    <li><strong>Valuation data stale</strong> → show "as of [date]" label, queue
                                        re-valuation</li>
                                    <li><strong>No partners available</strong> → show waitlist option, notify when
                                        available</li>
                                    <li><strong>Vehicle in active service</strong> → block "List for Sale" until service
                                        complete</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- WF5-8 AND SYSTEMS SECTIONS INJECTED BELOW -->
                    <div id="arch-part2">

                        <!-- WF5 -->
                        <div class="workflow-card" id="wf-5">
                            <div class="workflow-header" onclick="toggleWorkflow(this)">
                                <div class="workflow-num">5</div>
                                <div class="workflow-meta">
                                    <h4>Service Request → Execution → Completion</h4>
                                    <p>Vehicle owner OR concierge · Garage → "Request Service"</p>
                                </div>
                                <span class="workflow-toggle">▼</span>
                            </div>
                            <div class="workflow-body">
                                <div class="workflow-content">
                                    <h5>What They Do</h5>
                                    <ol>
                                        <li>Select service category: Logistics / Registration / Maintenance / Body
                                            Upgrade / Performance</li>
                                        <li>Describe need (free text + structured fields depending on category)</li>
                                        <li>Receive partner matches with quotes</li>
                                        <li>Approve quote → make payment</li>
                                        <li>Track service execution through stages</li>
                                        <li>Receive completion notification → confirm satisfaction</li>
                                    </ol>
                                    <h5>What They See</h5>
                                    <ul>
                                        <li><strong>Service request form</strong> (category-specific fields)</li>
                                        <li><strong>Partner options:</strong> name, rating, estimated time, price,
                                            specialties</li>
                                        <li><strong>Progress tracker:</strong> 6-stage state machine (Request → Quote →
                                            Payment → Execution → QC → Handover)</li>
                                        <li><strong>Completion:</strong> before/after photos, invoice, satisfaction
                                            survey</li>
                                    </ul>
                                    <h5>System Changes — State Machine</h5>
                                    <pre><code>STATE MACHINE (service_requests.workflow_state):
  'requested'   → Admin/system assigns partner → 'quoted'
  'quoted'      → User approves + pays       → 'paid'
  'paid'        → Partner begins work         → 'in_progress'
  'in_progress' → Partner submits completion  → 'qc_pending'
  'qc_pending'  → Admin verifies quality      → 'completed' (or 'qc_failed' → back to 'in_progress')
  'completed'   → User confirms handover      → 'closed'

CONSTRAINTS:
  - Cannot skip states. Cannot go from 'requested' to 'in_progress'.
  - 'completed' requires admin qc_passed = true flag
  - Every state change appends to vehicle_history JSONB log
  - Every state change triggers notification to user
  - Partner payment released only after 'closed' status</code></pre>
                                    <h5>What Can Fail</h5>
                                    <ul>
                                        <li><strong>Partner no-show</strong> → escalation timer (24h). Reassign to
                                            backup partner</li>
                                        <li><strong>QC failure</strong> → partner must redo. If repeated failure →
                                            partner tier downgrade</li>
                                        <li><strong>Payment dispute</strong> → escrow holds funds, concierge mediates
                                        </li>
                                        <li><strong>Service takes longer than estimated</strong> → automatic
                                            notification at 80% of estimated time</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- WF6 -->
                        <div class="workflow-card" id="wf-6">
                            <div class="workflow-header" onclick="toggleWorkflow(this)">
                                <div class="workflow-num">6</div>
                                <div class="workflow-meta">
                                    <h4>Dealer Onboarding → Inventory Management</h4>
                                    <p>Professional car dealer · "Become a Dealer" page</p>
                                </div>
                                <span class="workflow-toggle">▼</span>
                            </div>
                            <div class="workflow-body">
                                <div class="workflow-content">
                                    <h5>What They Do</h5>
                                    <ol>
                                        <li>Submit application: business name, CAC registration, business address,
                                            phone, ID</li>
                                        <li>Upload KYC documents: CAC certificate, valid ID, proof of address</li>
                                        <li>Wait for verification (admin reviews within 48h)</li>
                                        <li>Once approved → access dealer dashboard</li>
                                        <li>List vehicles: bulk upload or individual entry</li>
                                        <li>Manage auctions: create, monitor, settle</li>
                                        <li>View analytics: sales performance, market trends, inventory health</li>
                                    </ol>
                                    <h5>What They See</h5>
                                    <ul>
                                        <li>Application status tracker (submitted → under_review → approved/rejected)
                                        </li>
                                        <li><strong>Dealer dashboard:</strong> active listings, auction performance,
                                            revenue summary</li>
                                        <li><strong>Inventory management:</strong> add/edit/remove vehicles, set
                                            pricing, upload images</li>
                                        <li><strong>Market intelligence:</strong> demand trends, pricing
                                            recommendations, seasonal signals</li>
                                    </ul>
                                    <h5>System Changes</h5>
                                    <pre><code>ON APPLICATION:
  1. Insert `users` (role='dealer_pending')
  2. Insert `kyc_applications` (documents, status='pending')
  3. Notify admin of new dealer application

ON APPROVAL:
  1. Update `users.role` = 'dealer'
  2. Update `kyc_applications.status` = 'approved'
  3. Create `partner_profiles` record (tier='bronze', commission_rate=default)
  4. Provision API access if enterprise tier

ON VEHICLE LISTING:
  1. Validate: dealer.kyc_status = 'approved'
  2. Insert `vehicles` (catalog_id, vin, price, condition, images)
  3. Generate embedding → insert `vehicle_embeddings`
  4. If auction → create `auctions` record</code></pre>
                                    <h5>What Can Fail</h5>
                                    <ul>
                                        <li><strong>KYC documents illegible</strong> → rejection with specific feedback,
                                            re-upload flow</li>
                                        <li><strong>Duplicate VIN</strong> → reject listing, show existing vehicle
                                            record</li>
                                        <li><strong>Dealer account suspended</strong> → block all operations, show
                                            reason and appeal process</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- WF7 -->
                        <div class="workflow-card" id="wf-7">
                            <div class="workflow-header" onclick="toggleWorkflow(this)">
                                <div class="workflow-num">7</div>
                                <div class="workflow-meta">
                                    <h4>Admin Operations → Revenue Management</h4>
                                    <p>Platform admin/manager · Admin panel</p>
                                </div>
                                <span class="workflow-toggle">▼</span>
                            </div>
                            <div class="workflow-body">
                                <div class="workflow-content">
                                    <h5>What They Do</h5>
                                    <ol>
                                        <li>View revenue dashboard: daily/weekly/monthly GMV, take rate, active
                                            auctions, pending settlements</li>
                                        <li>Manage auctions: approve dealer-created auctions, set featured, monitor AI
                                            bidding</li>
                                        <li>Manage partners: view performance scores, adjust tiers, update commission
                                            rates</li>
                                        <li>Handle disputes: review flagged transactions, make manual adjustments</li>
                                        <li>Configure pricing: update global commission rates, service fees, featured
                                            listing costs</li>
                                        <li>Monitor AI: review model performance, cost tracking, cache hit rates</li>
                                    </ol>
                                    <h5>What They See</h5>
                                    <ul>
                                        <li>Real-time revenue metrics with charts (Chart.js)</li>
                                        <li><strong>Auction monitor:</strong> live auctions with bid activity, AI
                                            intervention status</li>
                                        <li><strong>Partner scorecards:</strong> quality/speed/satisfaction/volume
                                            breakdown</li>
                                        <li><strong>Transaction log:</strong> filterable by type, date, status, amount
                                        </li>
                                        <li><strong>Alert feed:</strong> flagged transactions, unusual activity, failed
                                            payments</li>
                                    </ul>
                                    <h5>System Changes</h5>
                                    <pre><code>ADMIN ACTIONS AND THEIR EFFECTS:

Commission Rate Update:
  → Update `commission_rates` table
  → Affects ALL future transactions immediately
  → Logged in `admin_audit_log`

Partner Tier Change:
  → Update `partner_profiles.tier`
  → Recalculate commission rate based on tier
  → Notify partner of tier change

Manual Transaction Override:
  → Insert `transactions` (type='manual_adjustment', approved_by=admin_id)
  → Update affected user's `wallet_balance`
  → Full audit trail in `admin_audit_log`

Auction Management:
  → Approve/reject dealer auctions (updates `auctions.status`)
  → Can force-end auction (emergency)
  → Can void auction results (with reason logged)</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- WF8 -->
                        <div class="workflow-card" id="wf-8">
                            <div class="workflow-header" onclick="toggleWorkflow(this)">
                                <div class="workflow-num">8</div>
                                <div class="workflow-meta">
                                    <h4>Concierge Task Handling</h4>
                                    <p>Concierge operator (human-in-the-loop) · Task queue</p>
                                </div>
                                <span class="workflow-toggle">▼</span>
                            </div>
                            <div class="workflow-body">
                                <div class="workflow-content">
                                    <h5>What They Do</h5>
                                    <ol>
                                        <li>View incoming user messages sorted by priority (High = active transaction,
                                            Low = browsing)</li>
                                        <li>Right-click message → "Convert to Task" → structured task created</li>
                                        <li>Assign task to appropriate partner or internal team</li>
                                        <li>Track task through completion</li>
                                        <li>Close task → trigger user notification</li>
                                    </ol>
                                    <h5>What They See</h5>
                                    <ul>
                                        <li>Message queue with priority color coding</li>
                                        <li><strong>Task board (kanban):</strong> New → Assigned → In Progress →
                                            Completed</li>
                                        <li><strong>Quick-action buttons:</strong> Create Service Request, Schedule
                                            Callback, Escalate to Manager</li>
                                        <li><strong>User context panel:</strong> user's vehicles, transaction history,
                                            sentiment score</li>
                                    </ul>
                                    <h5>System Changes</h5>
                                    <pre><code>ON TASK CREATION:
  1. Insert `concierge_tasks` (user_id, source_message, priority, type)
  2. If type matches service → auto-create `service_requests`
  3. Notify assigned operator

ON TASK COMPLETION:
  1. Update `concierge_tasks.status` = 'completed'
  2. Notify user with result/next steps
  3. Log resolution time for KPI tracking</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- ============================================ -->
                        <!-- SYSTEM SECTIONS -->
                        <!-- ============================================ -->

                        <!-- 1️⃣ IDENTITY SYSTEM -->
                        <div class="section" id="sys-identity">
                            <div class="section-header"><span class="label">System 1</span>
                                <h3>🔐 Identity System</h3>
                            </div>
                            <div class="card">
                                <div class="card-title">Authentication</div>
                                <ul>
                                    <li><strong>Method:</strong> Email + password (bcrypt hash) + optional phone OTP
                                        (Twilio/Termii)</li>
                                    <li><strong>Token:</strong> JWT with 24h expiry, refresh token with 7-day expiry
                                    </li>
                                    <li><strong>Storage:</strong> Access token in memory (not localStorage), refresh
                                        token in httpOnly cookie</li>
                                </ul>
                            </div>
                            <div class="card">
                                <div class="card-title">Roles (Hierarchical)</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Role</th>
                                            <th>Can Do</th>
                                            <th>Cannot Do</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>guest</code></td>
                                            <td>Browse catalog, use AI valuation, search</td>
                                            <td>Bid, access garage, request services</td>
                                        </tr>
                                        <tr>
                                            <td><code>user</code></td>
                                            <td>Everything guest can + bid, own vehicles, request services, use garage
                                            </td>
                                            <td>List vehicles for sale</td>
                                        </tr>
                                        <tr>
                                            <td><code>verified_seller</code></td>
                                            <td>Everything user can + list personal vehicles for sale</td>
                                            <td>Bulk listing, API access</td>
                                        </tr>
                                        <tr>
                                            <td><code>dealer</code></td>
                                            <td>Everything verified_seller can + bulk listing, inventory management,
                                                analytics</td>
                                            <td>Admin functions</td>
                                        </tr>
                                        <tr>
                                            <td><code>concierge</code></td>
                                            <td>View user messages, create tasks, assign partners</td>
                                            <td>Price config, financial overrides</td>
                                        </tr>
                                        <tr>
                                            <td><code>manager</code></td>
                                            <td>Everything concierge can + configure pricing, manage partners, view
                                                revenue</td>
                                            <td>User data deletion, system config</td>
                                        </tr>
                                        <tr>
                                            <td><code>admin</code></td>
                                            <td>Everything. Full system access</td>
                                            <td>—</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card">
                                <div class="card-title">Guest Access (Lead Magnet Strategy)</div>
                                <ul>
                                    <li><strong>Allowed without login:</strong> Vehicle catalog browsing, search, AI
                                        valuation (first result free, full report requires email), vehicle detail pages
                                    </li>
                                    <li><strong>Requires authentication:</strong> Placing bids, accessing digital
                                        garage, requesting services, viewing transaction history</li>
                                    <li><strong>Requires KYC:</strong> Participating in auctions (bidding), selling
                                        vehicles, withdrawing funds</li>
                                </ul>
                            </div>
                            <div class="card">
                                <div class="card-title">Session Management</div>
                                <ul>
                                    <li>Active sessions stored in Redis with TTL</li>
                                    <li>One active session per device (new login invalidates old session on same device
                                        type)</li>
                                    <li>Force-logout capability from admin panel</li>
                                </ul>
                            </div>
                        </div>

                        <!-- 2️⃣ BUSINESS LOGIC -->
                        <div class="section" id="sys-logic">
                            <div class="section-header"><span class="label">System 2</span>
                                <h3>⚡ Core Business Logic</h3>
                            </div>
                            <div class="card">
                                <div class="card-title">Central Entity: Vehicle</div>
                                <p style="color:var(--text-secondary);margin-bottom:12px">The vehicle is the nucleus.
                                    Every other entity revolves around it.</p>
                                <pre><code>Vehicle Lifecycle States:
  'catalog_only'       → exists in catalog but not physical inventory
  'available'          → physical vehicle ready for sale/auction
  'in_auction'         → currently in an active auction
  'pending_settlement' → auction won, awaiting payment
  'in_settlement'      → payment received, processing transfer
  'owned'              → in a user's garage
  'in_service'         → undergoing maintenance/upgrade
  'listed'             → owner listed for resale
  'sold'               → transaction complete, awaiting new owner confirmation
  'archived'           → removed from active inventory</code></pre>
                            </div>
                            <div class="card-grid card-grid-3">
                                <div class="card">
                                    <div class="card-title">Vehicles CRUD</div>
                                    <ul>
                                        <li><strong>Create:</strong> Admin/Dealer adds to inventory</li>
                                        <li><strong>Read:</strong> Anyone can browse. Owner sees full history</li>
                                        <li><strong>Update:</strong> Admin updates status. Owner updates listing price
                                        </li>
                                        <li><strong>Delete:</strong> Soft delete only (status → 'archived'). Never hard
                                            delete</li>
                                    </ul>
                                </div>
                                <div class="card">
                                    <div class="card-title">Auctions CRUD</div>
                                    <ul>
                                        <li><strong>Create:</strong> Admin/Dealer creates for a vehicle</li>
                                        <li><strong>Read:</strong> Anyone views active/upcoming</li>
                                        <li><strong>Update:</strong> System updates current_price on each bid</li>
                                        <li><strong>Delete:</strong> Never. Cancelled = status='cancelled'</li>
                                    </ul>
                                </div>
                                <div class="card">
                                    <div class="card-title">Service Requests CRUD</div>
                                    <ul>
                                        <li><strong>Create:</strong> User or concierge creates</li>
                                        <li><strong>Read:</strong> Owner, partner, and admin</li>
                                        <li><strong>Update:</strong> State machine transitions only</li>
                                        <li><strong>Delete:</strong> Never. Abandoned = 'cancelled'</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-title">Key State Machines</div>
                                <p style="font-size:13px;color:var(--text-secondary);margin-bottom:8px"><strong>Auction
                                        States:</strong></p>
                                <div class="flow">
                                    <span class="flow-step">draft</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">scheduled</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">live</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">ended</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">pending_settlement</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">settled</span>
                                </div>
                                <p style="font-size:12px;color:var(--text-muted);margin:4px 0">↘ 'unsold' → 'relisted' |
                                    'cancelled' (admin action at any pre-'ended' state)</p>
                                <p style="font-size:13px;color:var(--text-secondary);margin:16px 0 8px"><strong>Service
                                        Request States:</strong></p>
                                <div class="flow">
                                    <span class="flow-step">requested</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">quoted</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">paid</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">in_progress</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">qc_pending</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">completed</span><span class="flow-arrow">→</span>
                                    <span class="flow-step">closed</span>
                                </div>
                                <p style="font-size:12px;color:var(--text-muted);margin:4px 0">↘ 'qc_failed' → back to
                                    'in_progress'</p>
                            </div>
                        </div>

                        <!-- 3️⃣ DATA LAYER -->
                        <div class="section" id="sys-data">
                            <div class="section-header"><span class="label">System 3</span>
                                <h3>🗄️ Data Layer</h3>
                            </div>
                            <div class="card">
                                <div class="card-title">Database Strategy</div>
                                <ul>
                                    <li><strong>PostgreSQL</strong> (primary): All relational data, business logic,
                                        Pgvector embeddings</li>
                                    <li><strong>Redis:</strong> Sessions, cache, real-time auction state</li>
                                    <li><strong>File Storage:</strong> Cloudinary for images/documents</li>
                                </ul>
                                <div class="callout callout-warn"><strong>Note:</strong> MongoDB was in early docs but
                                    is <strong>not recommended for MVP</strong>. PostgreSQL handles logs and audit
                                    trails via JSONB columns. One database = simpler ops, ACID guarantees, lower cost.
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-title">Complete Schema <button
                                        onclick="openModal('Full Database Schema','schema-modal-content')"
                                        style="margin-left:auto;padding:6px 14px;background:var(--accent);color:#fff;border:none;border-radius:6px;font-size:11px;cursor:pointer;font-family:inherit;font-weight:600">View
                                        Full SQL ↗</button></div>
                                <p style="color:var(--text-secondary);font-size:13px;margin-bottom:12px">13 tables
                                    covering users, vehicles, auctions, bids, service requests, partners, transactions,
                                    concierge tasks, commission rates, admin audit log, and vector embeddings.</p>
                                <div class="card-grid card-grid-3">
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">users</div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, email, password_hash,
                                            phone, role, display_name, avatar_url, wallet_balance, kyc_status, kyc_data,
                                            is_active, last_login_at</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">vehicle_catalog
                                        </div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, make, model,
                                            year_start/end, trim, body_type, engine_code, displacement_cc, hp, torque,
                                            transmission, drivetrain, fuel_type, specs, prices, resell_rank</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">vehicles</div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, catalog_id, owner_id,
                                            listed_by, vin, year, condition, mileage_km, color, price, status, images,
                                            features, damage_report, trust_score, history_log</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">auctions</div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, vehicle_id, created_by,
                                            winner_id, auction_type, status, start_price, reserve_price, current_price,
                                            bid_increment, deposit_pct, start/end_time, bid/bidder_count</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">bids</div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, auction_id, user_id,
                                            amount, is_platform_bid, is_winning</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">service_requests
                                        </div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, vehicle_id, user_id,
                                            partner_id, service_type, workflow_state, quote_amount, invoice_total,
                                            commission_rate, qc_passed, state_log</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">partners</div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, user_id, business_name,
                                            specialties, service_area, tier, commission_rate, performance_score,
                                            total_jobs, avg_rating</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">transactions</div>
                                        <div style="font-size:11px;color:var(--text-muted)">id, user_id, type, amount,
                                            balance_after, reference_id, reference_type, paystack_ref, status,
                                            description</div>
                                    </div>
                                    <div
                                        style="padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border)">
                                        <div style="font-size:12px;font-weight:600;margin-bottom:4px">+ 5 more</div>
                                        <div style="font-size:11px;color:var(--text-muted)">concierge_tasks,
                                            commission_rates, admin_audit_log, vehicle_embeddings,
                                            user_interaction_embeddings</div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-title">Relationships</div>
                                <pre><code>users ──────────┬── owns ─────────── vehicles
                ├── bids_on ──────── bids → auctions → vehicles
                ├── requests ─────── service_requests → vehicles
                ├── has_tasks ────── concierge_tasks
                └── transacts ────── transactions

vehicle_catalog ── referenced_by ── vehicles
partners ───────── assigned_to ──── service_requests
admin_audit_log ── tracks ────────── users (admin actions)</code></pre>
                            </div>
                        </div>

                        <!-- REMAINING SYSTEMS INJECTED BELOW -->
                        <div id="arch-part3">

                            <!-- 4️⃣ ERROR HANDLING -->
                            <div class="section" id="sys-errors">
                                <div class="section-header"><span class="label">System 4</span>
                                    <h3>🛑 Error Handling</h3>
                                </div>
                                <div class="card">
                                    <div class="card-title">Critical Failure Points</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Failure</th>
                                                <th>Detection</th>
                                                <th>Response</th>
                                                <th>Recovery</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><strong>Concurrent bids</strong></td>
                                                <td>PostgreSQL row lock contention</td>
                                                <td>Serialize with <code>SELECT FOR UPDATE</code></td>
                                                <td>Losing transaction retries once, fails gracefully</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Paystack webhook missed</strong></td>
                                                <td>Transaction stuck in 'pending' &gt; 15min</td>
                                                <td>Cron job polls Paystack API for status</td>
                                                <td>Reconcile and update transaction</td>
                                            </tr>
                                            <tr>
                                                <td><strong>AI provider down</strong></td>
                                                <td>HTTP timeout / 5xx response</td>
                                                <td>Failover: Groq → OpenRouter → Anthropic</td>
                                                <td>Return cached result or "temporarily unavailable"</td>
                                            </tr>
                                            <tr>
                                                <td><strong>WebSocket disconnect</strong></td>
                                                <td>Client heartbeat timeout</td>
                                                <td>Auto-reconnect with exponential backoff</td>
                                                <td>REST fallback to get latest auction state</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Database connection lost</strong></td>
                                                <td>Connection pool health check</td>
                                                <td>Queue writes in Redis, retry on reconnect</td>
                                                <td>pgbouncer connection pooling</td>
                                            </tr>
                                            <tr>
                                                <td><strong>File upload failure</strong></td>
                                                <td>Cloudinary error response</td>
                                                <td>Retry 3x with backoff, then show error</td>
                                                <td>User can retry upload</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Duplicate VIN</strong></td>
                                                <td>UNIQUE constraint violation</td>
                                                <td>Return validation error with existing vehicle link</td>
                                                <td>Working as designed</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card">
                                    <div class="card-title">Validation Rules</div>
                                    <pre><code>USER INPUT:
  - Email: valid format, unique in DB
  - Phone: valid Nigerian format (+234...)
  - Password: min 8 chars, 1 uppercase, 1 number
  - VIN: exactly 17 alphanumeric characters
  - Bid amount: &gt; current_price + bid_increment, &lt;= user's buying_power

BUSINESS RULES:
  - Cannot bid on own auction
  - Cannot bid if wallet_balance &lt; required deposit
  - Cannot place bid after auction end_time
  - Cannot transition service request to 'completed' without qc_passed = true
  - Cannot withdraw funds while active bids exist (committed capital)
  - Wallet balance can never go negative

DATA INTEGRITY:
  - Vehicle cannot be in two active auctions simultaneously
  - User cannot have role changed to 'dealer' without kyc_status = 'approved'
  - Transactions must always update wallet_balance atomically (use DB transactions)</code></pre>
                                </div>
                            </div>

                            <!-- 5️⃣ SECURITY -->
                            <div class="section" id="sys-security">
                                <div class="section-header"><span class="label">System 5</span>
                                    <h3>🛡️ Security</h3>
                                </div>
                                <div class="card">
                                    <div class="card-title">Permission Matrix (Route-Level)</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Route Pattern</th>
                                                <th>guest</th>
                                                <th>user</th>
                                                <th>dealer</th>
                                                <th>concierge</th>
                                                <th>manager</th>
                                                <th>admin</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>GET /api/vehicles</code></td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>GET /api/vehicles/:id</code></td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>GET /api/valuation</code></td>
                                                <td class="perm-yes">✅*</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>POST /api/bids</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>GET /api/garage</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>POST /api/vehicles</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>POST /api/auctions</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>GET /api/concierge/tasks</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>PATCH /api/admin/*</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                            <tr>
                                                <td><code>DELETE /api/admin/*</code></td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-no">❌</td>
                                                <td class="perm-yes">✅</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p style="font-size:12px;color:var(--text-muted);margin-top:8px">*Guest valuation
                                        requires email capture</p>
                                </div>
                                <div class="card">
                                    <div class="card-title">Sensitive Data Handling</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Storage</th>
                                                <th>Access</th>
                                                <th>Protection</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Passwords</td>
                                                <td><code>password_hash</code> (bcrypt, 12 rounds)</td>
                                                <td>Never returned in API</td>
                                                <td>—</td>
                                            </tr>
                                            <tr>
                                                <td>KYC documents</td>
                                                <td>Cloudinary (private URLs)</td>
                                                <td>Owner + admin only</td>
                                                <td>Signed URLs with 1h expiry</td>
                                            </tr>
                                            <tr>
                                                <td>Wallet balance</td>
                                                <td>PostgreSQL</td>
                                                <td>Owner + admin only</td>
                                                <td>Atomic DB transactions</td>
                                            </tr>
                                            <tr>
                                                <td>Payment tokens</td>
                                                <td>Never stored</td>
                                                <td>Paystack handles</td>
                                                <td>PCI compliance via Paystack</td>
                                            </tr>
                                            <tr>
                                                <td>JWT secrets</td>
                                                <td>Environment variable</td>
                                                <td>Server-side only</td>
                                                <td>Rotated quarterly</td>
                                            </tr>
                                            <tr>
                                                <td>API keys</td>
                                                <td>Environment variable</td>
                                                <td>Server-side only</td>
                                                <td>Different keys per env</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card">
                                    <div class="card-title">API Security Layers</div>
                                    <pre><code>Request → Rate Limiter (100/min per IP, 1000/min per authenticated user)
       → CORS (whitelist known origins only)
       → JWT Verification (check expiry, signature, blacklist)
       → Role Authorization (middleware checks route permissions)
       → Input Sanitization (parameterized queries, no string concat SQL)
       → Business Rule Validation (service layer checks)
       → Response (strip sensitive fields before sending)</code></pre>
                                </div>
                            </div>

                            <!-- 6️⃣ DEPLOYMENT -->
                            <div class="section" id="sys-deploy">
                                <div class="section-header"><span class="label">System 6</span>
                                    <h3>🚀 Deployment Plan</h3>
                                </div>
                                <div class="card">
                                    <div class="card-title">Infrastructure &amp; Cost</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Component</th>
                                                <th>Service</th>
                                                <th>Cost</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Web Application</td>
                                                <td>Render.com (Web Service)</td>
                                                <td>$7-25/mo</td>
                                            </tr>
                                            <tr>
                                                <td>PostgreSQL</td>
                                                <td>Render Managed PostgreSQL</td>
                                                <td>$7-50/mo</td>
                                            </tr>
                                            <tr>
                                                <td>Redis</td>
                                                <td>Render Managed Redis</td>
                                                <td>$10/mo</td>
                                            </tr>
                                            <tr>
                                                <td>File Storage</td>
                                                <td>Cloudinary (Free → Pro)</td>
                                                <td>$0-89/mo</td>
                                            </tr>
                                            <tr>
                                                <td>Domain</td>
                                                <td>Namecheap / Google Domains</td>
                                                <td>$12/yr</td>
                                            </tr>
                                            <tr>
                                                <td>SSL</td>
                                                <td>Render (included)</td>
                                                <td>Free</td>
                                            </tr>
                                            <tr>
                                                <td>Monitoring</td>
                                                <td>Sentry (free tier)</td>
                                                <td>$0</td>
                                            </tr>
                                            <tr>
                                                <td>Email</td>
                                                <td>SendGrid (free tier)</td>
                                                <td>$0</td>
                                            </tr>
                                            <tr>
                                                <td>SMS/OTP</td>
                                                <td>Termii</td>
                                                <td>Pay-per-use</td>
                                            </tr>
                                            <tr>
                                                <td>Payments</td>
                                                <td>Paystack</td>
                                                <td>1.5% per txn</td>
                                            </tr>
                                            <tr>
                                                <td>AI APIs</td>
                                                <td>Groq + OpenRouter</td>
                                                <td>~$30-40/mo</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="callout callout-success"><strong>Total MVP infrastructure:
                                            ~$50-150/month</strong></div>
                                </div>
                                <div class="card">
                                    <div class="card-title">Docker Configuration</div>
                                    <pre><code># docker-compose.yml (production)
services:
  app:
    build: .
    ports: ["3000:3000"]
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_SECRET=${JWT_SECRET}
      - PAYSTACK_SECRET_KEY=${PAYSTACK_SECRET_KEY}
      - GROQ_API_KEY=${GROQ_API_KEY}
      - CLOUDINARY_URL=${CLOUDINARY_URL}
      - TERMII_API_KEY=${TERMII_API_KEY}
    depends_on: [db, redis]
  db:
    image: pgvector/pgvector:pg16
    volumes: [pgdata:/var/lib/postgresql/data]
    environment:
      - POSTGRES_DB=dealer360
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
  redis:
    image: redis:7-alpine
    volumes: [redisdata:/data]
volumes:
  pgdata:
  redisdata:</code></pre>
                                </div>
                                <div class="card">
                                    <div class="card-title">Required Environment Variables</div>
                                    <pre><code># Database
DATABASE_URL=postgresql://user:pass@host:5432/dealer360
REDIS_URL=redis://host:6379

# Authentication
JWT_SECRET=&lt;random-64-char-string&gt;
JWT_REFRESH_SECRET=&lt;random-64-char-string&gt;

# Payments
PAYSTACK_SECRET_KEY=sk_live_xxx
PAYSTACK_PUBLIC_KEY=pk_live_xxx
PAYSTACK_WEBHOOK_SECRET=whsec_xxx

# AI
GROQ_API_KEY=gsk_xxx
OPENROUTER_API_KEY=sk-or-xxx
OPENAI_API_KEY=sk-xxx  # for embeddings only

# File Storage
CLOUDINARY_CLOUD_NAME=xxx
CLOUDINARY_API_KEY=xxx
CLOUDINARY_API_SECRET=xxx

# Notifications
TERMII_API_KEY=xxx
SENDGRID_API_KEY=xxx

# Application
APP_URL=https://dealer360.ng
CORS_ORIGINS=https://dealer360.ng,https://admin.dealer360.ng
NODE_ENV=production
PORT=3000</code></pre>
                                </div>
                            </div>

                            <!-- 7️⃣ UX COMPLETION -->
                            <div class="section" id="sys-ux">
                                <div class="section-header"><span class="label">System 7</span>
                                    <h3>📱 UX Completion</h3>
                                </div>
                                <div class="card-grid card-grid-2">
                                    <div class="card">
                                        <div class="card-title">Mobile-First Strategy</div>
                                        <ul>
                                            <li>All layouts designed mobile-first (320px → 768px → 1024px → 1440px)</li>
                                            <li>Touch targets minimum 44×44px</li>
                                            <li>Bottom navigation on mobile (most-used actions within thumb reach)</li>
                                            <li>Swipe gestures for vehicle gallery</li>
                                        </ul>
                                    </div>
                                    <div class="card">
                                        <div class="card-title">PWA Requirements</div>
                                        <ul>
                                            <li><code>manifest.json</code> with app name, icons, theme color</li>
                                            <li>Service worker for offline catalog browsing</li>
                                            <li>Add-to-homescreen prompt after 2nd visit</li>
                                            <li>Push notifications via service worker (auction alerts)</li>
                                        </ul>
                                    </div>
                                    <div class="card">
                                        <div class="card-title">Offline Support</div>
                                        <ul>
                                            <li><strong>Full offline:</strong> Vehicle catalog (cached on first load)
                                            </li>
                                            <li><strong>Partial offline:</strong> Garage view (syncs when online)</li>
                                            <li><strong>Online only:</strong> Bidding, payments, real-time auction room
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card">
                                        <div class="card-title">Accessibility</div>
                                        <ul>
                                            <li>ARIA labels on all interactive elements</li>
                                            <li>Keyboard navigation for desktop</li>
                                            <li>Color contrast ratio ≥ 4.5:1</li>
                                            <li>Screen reader compatible headings &amp; landmarks</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-title">Loading States (Every Async Operation)</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Action</th>
                                                <th>Loading State</th>
                                                <th>Error State</th>
                                                <th>Empty State</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Vehicle search</td>
                                                <td>Skeleton cards (3-6 placeholders)</td>
                                                <td>"Search failed. Try again." + retry</td>
                                                <td>"No vehicles match. Try adjusting filters."</td>
                                            </tr>
                                            <tr>
                                                <td>Auction room</td>
                                                <td>Full-screen spinner + "Connecting..."</td>
                                                <td>"Connection failed. Retrying..." + retry</td>
                                                <td>Never empty</td>
                                            </tr>
                                            <tr>
                                                <td>Placing bid</td>
                                                <td>Button spinner + "Placing bid..."</td>
                                                <td>Toast: "Bid failed: [reason]"</td>
                                                <td>—</td>
                                            </tr>
                                            <tr>
                                                <td>Wallet loading</td>
                                                <td>Skeleton balance bar</td>
                                                <td>"Unable to load balance" + retry</td>
                                                <td>"₦0.00 — Fund your wallet"</td>
                                            </tr>
                                            <tr>
                                                <td>Service request</td>
                                                <td>Step-by-step progress animation</td>
                                                <td>Toast with error + retry</td>
                                                <td>—</td>
                                            </tr>
                                            <tr>
                                                <td>AI Valuation</td>
                                                <td>Typing animation: "AI analyzing..."</td>
                                                <td>"Analysis unavailable. Try later."</td>
                                                <td>—</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>

                        <!-- Hidden modal content for full SQL schema -->
                        <div id="schema-modal-content" style="display:none">
                            <pre><code>-- Full SQL Schema (13 Tables)
-- See SYSTEM-ARCHITECTURE-AND-WORKFLOWS.md for complete DDL

CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  phone VARCHAR(20),
  role VARCHAR(20) NOT NULL DEFAULT 'user'
    CHECK (role IN ('user','verified_seller','dealer','concierge','manager','admin')),
  display_name VARCHAR(100), avatar_url TEXT,
  wallet_balance DECIMAL(15,2) DEFAULT 0.00,
  kyc_status VARCHAR(20) DEFAULT 'none',
  kyc_data JSONB DEFAULT '{}',
  is_active BOOLEAN DEFAULT true,
  last_login_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE vehicle_catalog (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  make VARCHAR(50) NOT NULL, model VARCHAR(100) NOT NULL,
  year_start INT NOT NULL, year_end INT, trim VARCHAR(50),
  body_type VARCHAR(30), engine_code VARCHAR(30),
  displacement_cc INT, horsepower INT, torque_nm INT,
  transmission VARCHAR(30), drivetrain VARCHAR(10), fuel_type VARCHAR(20),
  specs JSONB DEFAULT '{}',
  price_foreign_used DECIMAL(15,2), price_nigerian_used DECIMAL(15,2),
  price_brand_new DECIMAL(15,2), clearing_cost_est DECIMAL(15,2),
  resell_rank INT, popularity_index INT
);

CREATE TABLE vehicles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  catalog_id UUID REFERENCES vehicle_catalog(id),
  owner_id UUID REFERENCES users(id),
  listed_by UUID REFERENCES users(id),
  vin VARCHAR(17) UNIQUE, year INT NOT NULL,
  condition VARCHAR(20) DEFAULT 'clean',
  mileage_km INT, color VARCHAR(30), price DECIMAL(15,2),
  status VARCHAR(25) DEFAULT 'available',
  images JSONB DEFAULT '[]', features JSONB DEFAULT '[]',
  damage_report JSONB DEFAULT '{}',
  trust_score INT, history_log JSONB DEFAULT '[]', location VARCHAR(100)
);

CREATE TABLE auctions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  vehicle_id UUID REFERENCES vehicles(id) NOT NULL,
  created_by UUID REFERENCES users(id) NOT NULL,
  winner_id UUID REFERENCES users(id),
  auction_type VARCHAR(20) DEFAULT 'timed',
  status VARCHAR(25) DEFAULT 'draft',
  start_price DECIMAL(15,2) NOT NULL, reserve_price DECIMAL(15,2),
  current_price DECIMAL(15,2), bid_increment DECIMAL(15,2) DEFAULT 50000,
  deposit_pct DECIMAL(5,2) DEFAULT 20.00,
  start_time TIMESTAMP NOT NULL, end_time TIMESTAMP NOT NULL,
  original_end TIMESTAMP, bid_count INT DEFAULT 0,
  bidder_count INT DEFAULT 0, ai_bids_placed INT DEFAULT 0,
  featured BOOLEAN DEFAULT false
);

CREATE TABLE bids (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  auction_id UUID REFERENCES auctions(id) NOT NULL,
  user_id UUID REFERENCES users(id) NOT NULL,
  amount DECIMAL(15,2) NOT NULL,
  is_platform_bid BOOLEAN DEFAULT false,
  is_winning BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE service_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  vehicle_id UUID REFERENCES vehicles(id) NOT NULL,
  user_id UUID REFERENCES users(id) NOT NULL,
  partner_id UUID REFERENCES partners(id),
  service_type VARCHAR(30) NOT NULL, workflow_state VARCHAR(20) DEFAULT 'requested',
  description TEXT, quote_amount DECIMAL(15,2), invoice_total DECIMAL(15,2),
  commission_rate DECIMAL(5,4), platform_fee DECIMAL(15,2),
  qc_passed BOOLEAN, qc_notes TEXT, state_log JSONB DEFAULT '[]',
  estimated_days INT, due_date DATE
);

CREATE TABLE partners (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  business_name VARCHAR(200) NOT NULL, specialties JSONB DEFAULT '[]',
  service_area VARCHAR(100), tier VARCHAR(20) DEFAULT 'bronze',
  commission_rate DECIMAL(5,4) DEFAULT 0.1500,
  performance_score INT DEFAULT 50, total_jobs INT DEFAULT 0,
  avg_rating DECIMAL(3,2) DEFAULT 0.00, is_active BOOLEAN DEFAULT true
);

CREATE TABLE transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  type VARCHAR(30) NOT NULL, amount DECIMAL(15,2) NOT NULL,
  balance_after DECIMAL(15,2), reference_id UUID,
  reference_type VARCHAR(30), paystack_ref VARCHAR(100),
  status VARCHAR(20) DEFAULT 'pending', description TEXT
);

CREATE TABLE concierge_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  assigned_to UUID REFERENCES users(id),
  source_message TEXT, task_type VARCHAR(30),
  priority VARCHAR(10) DEFAULT 'medium',
  status VARCHAR(20) DEFAULT 'new', resolution TEXT,
  created_at TIMESTAMP DEFAULT NOW(), resolved_at TIMESTAMP
);

CREATE TABLE commission_rates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  service_type VARCHAR(30) UNIQUE NOT NULL,
  base_rate DECIMAL(5,4) NOT NULL,
  min_rate DECIMAL(5,4), max_rate DECIMAL(5,4),
  rules JSONB DEFAULT '[]', updated_by UUID REFERENCES users(id)
);

CREATE TABLE admin_audit_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID REFERENCES users(id) NOT NULL,
  action VARCHAR(50) NOT NULL, target_type VARCHAR(30),
  target_id UUID, old_value JSONB, new_value JSONB,
  reason TEXT, ip_address INET
);

CREATE EXTENSION IF NOT EXISTS vector;
CREATE TABLE vehicle_embeddings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  vehicle_id UUID REFERENCES vehicles(id) ON DELETE CASCADE,
  embedding vector(1536), embedded_text TEXT
);
CREATE TABLE user_interaction_embeddings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  embedding vector(1536), interaction_type VARCHAR(30),
  interaction_data JSONB
);</code></pre>
                        </div>

                    </div>

                </div>
            </div>
            <div class="doc-page" id="page-mvp">
                <div id="mvp-content">

                    <!-- THE RAZOR -->
                    <div class="section" id="mvp-razor">
                        <div class="section-header">
                            <span class="label">MVP Philosophy</span>
                            <h2>🎯 The Razor</h2>
                            <p>If it doesn't directly prove "people will pay to buy/sell cars through an AI-powered
                                auction platform" — it's out.</p>
                        </div>
                        <div class="callout callout-warn"><strong>Zero feature creep.</strong> The MVP proves exactly
                            one thing: the core transaction loop works and generates revenue.</div>
                        <div class="card">
                            <div class="card-title">What the MVP Must Prove</div>
                            <ol>
                                <li><strong>Discovery:</strong> A user can find a vehicle they want</li>
                                <li><strong>Trust:</strong> AI valuation gives them confidence in pricing</li>
                                <li><strong>Transaction:</strong> They can bid, win, and pay</li>
                                <li><strong>Fulfillment:</strong> The platform manages post-purchase flow</li>
                                <li><strong>Revenue:</strong> The platform takes a commission on every transaction</li>
                            </ol>
                        </div>
                    </div>

                    <!-- SCOPE -->
                    <div class="section" id="mvp-scope">
                        <div class="section-header"><span class="label">Feature Scope</span>
                            <h3>✂️ What's IN vs What's OUT</h3>
                        </div>
                        <div class="card-grid card-grid-2">
                            <div class="card" style="border-left:3px solid var(--success)">
                                <div class="card-title" style="color:var(--success)">✅ IN (Must Ship)</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>Why It's Essential</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>Auth (Email/Password + JWT)</strong></td>
                                            <td>Users must have accounts to bid and own vehicles</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Vehicle Catalog Browse/Search</strong></td>
                                            <td>Core discovery — the front door</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Vehicle Detail Page</strong></td>
                                            <td>Trust builder — specs, images, market comparison</td>
                                        </tr>
                                        <tr>
                                            <td><strong>AI Valuation Tool</strong></td>
                                            <td>Key differentiator. Proves AI adds value. Lead magnet</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Live Auctions (Timed)</strong></td>
                                            <td>Core revenue mechanism. Must work flawlessly</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Real-time Bidding (WebSocket)</strong></td>
                                            <td>Auctions are meaningless without live updates</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Wallet (Deposit/Withdraw via Paystack)</strong></td>
                                            <td>Users need money in the system to bid</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Post-Auction Settlement Flow</strong></td>
                                            <td>Proves full transaction loop closes</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Basic Admin Panel</strong></td>
                                            <td>Someone needs to manage auctions and view revenue</td>
                                        </tr>
                                        <tr>
                                            <td><strong>My Garage (Owned Vehicles List)</strong></td>
                                            <td>Users need to see what they own</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card" style="border-left:3px solid var(--error)">
                                <div class="card-title" style="color:var(--error)">❌ OUT (Post-MVP)</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>Why It's Deferred</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>3D Garage / Spatial Commerce</td>
                                            <td>Cool but not revenue-critical. Adds 4+ weeks</td>
                                        </tr>
                                        <tr>
                                            <td>Concierge System (Chat + Tasks)</td>
                                            <td>Can be done manually via WhatsApp/phone initially</td>
                                        </tr>
                                        <tr>
                                            <td>Service Request Marketplace</td>
                                            <td>Needs partner network first. Manual matchmaking for now</td>
                                        </tr>
                                        <tr>
                                            <td>Multi-LLM Orchestration</td>
                                            <td>Single provider (Groq) is sufficient for launch</td>
                                        </tr>
                                        <tr>
                                            <td>Import/Clearing Orchestration</td>
                                            <td>Manual process works. Automate after proving demand</td>
                                        </tr>
                                        <tr>
                                            <td>Partner Portal</td>
                                            <td>Partners can be managed via admin panel initially</td>
                                        </tr>
                                        <tr>
                                            <td>Enterprise B2B Data API</td>
                                            <td>Zero customers yet. Build when there's demand</td>
                                        </tr>
                                        <tr>
                                            <td>Push Notifications / PWA</td>
                                            <td>Email notifications sufficient for MVP volume</td>
                                        </tr>
                                        <tr>
                                            <td>Advanced Analytics Dashboard</td>
                                            <td>PostgreSQL queries + basic charts are enough to start</td>
                                        </tr>
                                        <tr>
                                            <td>Phone OTP Auth</td>
                                            <td>Email auth works. Add OTP when user volume demands it</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ARCHITECTURE -->
                    <div class="section" id="mvp-arch">
                        <div class="section-header"><span class="label">Technical</span>
                            <h3>🏗️ MVP Architecture</h3>
                        </div>
                        <div class="card">
                            <div class="card-title">Tech Stack (Lean)</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Layer</th>
                                        <th>Technology</th>
                                        <th>Why This Over Alternatives</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Frontend</strong></td>
                                        <td>Next.js 14 (App Router)</td>
                                        <td>SSR for SEO, RSC for performance, large ecosystem</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Styling</strong></td>
                                        <td>Tailwind CSS</td>
                                        <td>Rapid UI development, consistent design system</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Backend</strong></td>
                                        <td>Express.js (Node 20)</td>
                                        <td>Proven, fast development, shared JS ecosystem</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Database</strong></td>
                                        <td>PostgreSQL 16</td>
                                        <td>ACID, JSONB, Pgvector, single source of truth</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Real-time</strong></td>
                                        <td>Socket.IO</td>
                                        <td>WebSocket with fallback. Works everywhere</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Payments</strong></td>
                                        <td>Paystack</td>
                                        <td>Nigerian market leader. 1.5% fee. Well-documented</td>
                                    </tr>
                                    <tr>
                                        <td><strong>AI</strong></td>
                                        <td>Groq (Llama 3.1)</td>
                                        <td>Fastest inference, free tier generous, Nigerian market context via prompts
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>File Storage</strong></td>
                                        <td>Cloudinary</td>
                                        <td>Image optimization, transformation, free tier</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Hosting</strong></td>
                                        <td>Render.com</td>
                                        <td>Simple deploy, managed Postgres, $7/mo base</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="card">
                            <div class="card-title">What's NOT Used in MVP</div>
                            <ul>
                                <li><strong>No Redis</strong> — PostgreSQL for sessions (low volume). Add Redis when
                                    >1000 concurrent users</li>
                                <li><strong>No MongoDB</strong> — JSONB columns handle flexible data. One database =
                                    simpler ops</li>
                                <li><strong>No multiple AI providers</strong> — Groq only. Add failover providers
                                    post-MVP</li>
                                <li><strong>No Docker in production</strong> — Render handles containerization. Docker
                                    only for local dev</li>
                                <li><strong>No separate microservices</strong> — Monolith. Split when you have scale
                                    problems, not before</li>
                            </ul>
                        </div>
                    </div>

                    <!-- DATA MODEL -->
                    <div class="section" id="mvp-data">
                        <div class="section-header"><span class="label">Database</span>
                            <h3>🗄️ MVP Data Model (7 Tables)</h3>
                        </div>
                        <div class="callout callout-info">Reduced from 13 tables to 7. Every table must justify its
                            existence by serving a core transaction flow.</div>
                        <div class="card">
                            <div class="card-title">MVP Tables</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Table</th>
                                        <th>Intent</th>
                                        <th>Key Fields</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>users</code></td>
                                        <td>Authentication + wallet</td>
                                        <td>email, password_hash, role, wallet_balance, kyc_status</td>
                                    </tr>
                                    <tr>
                                        <td><code>vehicle_catalog</code></td>
                                        <td>Reference specs (read-heavy)</td>
                                        <td>make, model, year, specs, prices</td>
                                    </tr>
                                    <tr>
                                        <td><code>vehicles</code></td>
                                        <td>Physical inventory</td>
                                        <td>catalog_id, owner_id, vin, status, price, images, trust_score</td>
                                    </tr>
                                    <tr>
                                        <td><code>auctions</code></td>
                                        <td>Auction instances</td>
                                        <td>vehicle_id, status, start/reserve/current_price, start/end_time</td>
                                    </tr>
                                    <tr>
                                        <td><code>bids</code></td>
                                        <td>Individual bid records</td>
                                        <td>auction_id, user_id, amount, is_platform_bid, is_winning</td>
                                    </tr>
                                    <tr>
                                        <td><code>transactions</code></td>
                                        <td>All money movement</td>
                                        <td>user_id, type, amount, balance_after, paystack_ref, status</td>
                                    </tr>
                                    <tr>
                                        <td><code>admin_audit_log</code></td>
                                        <td>Admin action trail</td>
                                        <td>admin_id, action, target_type, target_id, old/new_value</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="card">
                            <div class="card-title">Deferred Tables</div>
                            <ul>
                                <li><code>service_requests</code> → Manual via WhatsApp/admin for now</li>
                                <li><code>partners</code> → No partner marketplace in MVP</li>
                                <li><code>concierge_tasks</code> → No formal concierge system yet</li>
                                <li><code>commission_rates</code> → Hardcoded in config. DB table when rates vary by
                                    partner</li>
                                <li><code>vehicle_embeddings</code> / <code>user_interaction_embeddings</code> →
                                    Pgvector added post-MVP when recommendation engine built</li>
                            </ul>
                        </div>
                    </div>

                    <!-- PAGES -->
                    <div class="section" id="mvp-pages">
                        <div class="section-header"><span class="label">Frontend</span>
                            <h3>📄 MVP Pages (15 Total)</h3>
                        </div>
                        <div class="card">
                            <table>
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Page</th>
                                        <th>Route</th>
                                        <th>Auth Required</th>
                                        <th>Purpose</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Home / Landing</td>
                                        <td><code>/</code></td>
                                        <td>❌</td>
                                        <td>Hero, featured vehicles, AI valuation CTA</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Login</td>
                                        <td><code>/login</code></td>
                                        <td>❌</td>
                                        <td>Email + password login form</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Register</td>
                                        <td><code>/register</code></td>
                                        <td>❌</td>
                                        <td>Account creation</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>Vehicle Catalog</td>
                                        <td><code>/vehicles</code></td>
                                        <td>❌</td>
                                        <td>Browse + search + filter all vehicles</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>Vehicle Detail</td>
                                        <td><code>/vehicles/[id]</code></td>
                                        <td>❌</td>
                                        <td>Full specs, gallery, valuation, auction link</td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>AI Valuation</td>
                                        <td><code>/valuation</code></td>
                                        <td>Email*</td>
                                        <td>Input make/model/year → get market report</td>
                                    </tr>
                                    <tr>
                                        <td>7</td>
                                        <td>Active Auctions</td>
                                        <td><code>/auctions</code></td>
                                        <td>❌</td>
                                        <td>List of live + upcoming auctions</td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>Auction Room</td>
                                        <td><code>/auctions/[id]</code></td>
                                        <td>✅</td>
                                        <td>Live bidding interface with WebSocket</td>
                                    </tr>
                                    <tr>
                                        <td>9</td>
                                        <td>Dashboard</td>
                                        <td><code>/dashboard</code></td>
                                        <td>✅</td>
                                        <td>User's overview: wallet, active bids, owned vehicles</td>
                                    </tr>
                                    <tr>
                                        <td>10</td>
                                        <td>Wallet</td>
                                        <td><code>/dashboard/wallet</code></td>
                                        <td>✅</td>
                                        <td>Balance, fund, withdraw, transaction history</td>
                                    </tr>
                                    <tr>
                                        <td>11</td>
                                        <td>My Garage</td>
                                        <td><code>/dashboard/garage</code></td>
                                        <td>✅</td>
                                        <td>Owned vehicles with current valuations</td>
                                    </tr>
                                    <tr>
                                        <td>12</td>
                                        <td>My Bids</td>
                                        <td><code>/dashboard/bids</code></td>
                                        <td>✅</td>
                                        <td>Active/won/lost bid history</td>
                                    </tr>
                                    <tr>
                                        <td>13</td>
                                        <td>Profile / KYC</td>
                                        <td><code>/dashboard/profile</code></td>
                                        <td>✅</td>
                                        <td>Edit profile, submit KYC documents</td>
                                    </tr>
                                    <tr>
                                        <td>14</td>
                                        <td>Admin Dashboard</td>
                                        <td><code>/admin</code></td>
                                        <td>🔒 admin</td>
                                        <td>Revenue, active auctions, user management</td>
                                    </tr>
                                    <tr>
                                        <td>15</td>
                                        <td>Admin Auction Mgmt</td>
                                        <td><code>/admin/auctions</code></td>
                                        <td>🔒 admin</td>
                                        <td>Create, approve, monitor, end auctions</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="font-size:12px;color:var(--text-muted);margin-top:8px">*Email captured as lead
                                magnet, not full auth</p>
                        </div>
                    </div>

                    <!-- API ENDPOINTS -->
                    <div class="section" id="mvp-api">
                        <div class="section-header"><span class="label">Backend</span>
                            <h3>🔌 MVP API Endpoints (~20)</h3>
                        </div>
                        <div class="card">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Method</th>
                                        <th>Endpoint</th>
                                        <th>Auth</th>
                                        <th>Purpose</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4"
                                            style="font-weight:700;background:var(--bg-secondary);padding:8px;letter-spacing:0.3px">
                                            AUTH</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/auth/register</code></td>
                                        <td>❌</td>
                                        <td>Create account</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/auth/login</code></td>
                                        <td>❌</td>
                                        <td>Get JWT tokens</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/auth/refresh</code></td>
                                        <td>🔄</td>
                                        <td>Refresh access token</td>
                                    </tr>
                                    <tr>
                                        <td colspan="4"
                                            style="font-weight:700;background:var(--bg-secondary);padding:8px;letter-spacing:0.3px">
                                            VEHICLES</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/vehicles</code></td>
                                        <td>❌</td>
                                        <td>List with filters/search/pagination</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/vehicles/:id</code></td>
                                        <td>❌</td>
                                        <td>Full vehicle details + catalog specs</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/vehicles</code></td>
                                        <td>🔒</td>
                                        <td>Create vehicle (admin/dealer)</td>
                                    </tr>
                                    <tr>
                                        <td colspan="4"
                                            style="font-weight:700;background:var(--bg-secondary);padding:8px;letter-spacing:0.3px">
                                            AUCTIONS</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/auctions</code></td>
                                        <td>❌</td>
                                        <td>List active/upcoming auctions</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/auctions/:id</code></td>
                                        <td>❌</td>
                                        <td>Auction details + bid history</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/auctions</code></td>
                                        <td>🔒</td>
                                        <td>Create auction (admin)</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/auctions/:id/bid</code></td>
                                        <td>✅</td>
                                        <td>Place bid (validated + broadcast)</td>
                                    </tr>
                                    <tr>
                                        <td colspan="4"
                                            style="font-weight:700;background:var(--bg-secondary);padding:8px;letter-spacing:0.3px">
                                            WALLET</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/wallet</code></td>
                                        <td>✅</td>
                                        <td>Get balance + recent transactions</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/wallet/fund</code></td>
                                        <td>✅</td>
                                        <td>Initiate Paystack funding</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/wallet/webhook</code></td>
                                        <td>🔐</td>
                                        <td>Paystack webhook handler</td>
                                    </tr>
                                    <tr>
                                        <td colspan="4"
                                            style="font-weight:700;background:var(--bg-secondary);padding:8px;letter-spacing:0.3px">
                                            AI</td>
                                    </tr>
                                    <tr>
                                        <td><code>POST</code></td>
                                        <td><code>/api/valuation</code></td>
                                        <td>Email</td>
                                        <td>AI market valuation</td>
                                    </tr>
                                    <tr>
                                        <td colspan="4"
                                            style="font-weight:700;background:var(--bg-secondary);padding:8px;letter-spacing:0.3px">
                                            USER</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/me</code></td>
                                        <td>✅</td>
                                        <td>Current user profile</td>
                                    </tr>
                                    <tr>
                                        <td><code>PATCH</code></td>
                                        <td><code>/api/me</code></td>
                                        <td>✅</td>
                                        <td>Update profile</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/me/garage</code></td>
                                        <td>✅</td>
                                        <td>My owned vehicles</td>
                                    </tr>
                                    <tr>
                                        <td><code>GET</code></td>
                                        <td><code>/api/me/bids</code></td>
                                        <td>✅</td>
                                        <td>My bid history</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- FOLDER STRUCTURE -->
                    <div class="section" id="mvp-folder">
                        <div class="section-header"><span class="label">Project</span>
                            <h3>📁 Folder Structure (Monorepo)</h3>
                        </div>
                        <div class="card">
                            <pre><code>dealer360/
├── client/                    # Next.js 14 Frontend
│   ├── src/
│   │   ├── app/
│   │   │   ├── (auth)/        # Login, Register
│   │   │   ├── (dashboard)/   # Dashboard, Wallet, Garage, Bids, Profile
│   │   │   ├── (admin)/       # Admin pages
│   │   │   ├── vehicles/      # Catalog, Vehicle Detail
│   │   │   ├── auctions/      # Auction List, Auction Room
│   │   │   ├── valuation/     # AI Valuation
│   │   │   ├── layout.tsx
│   │   │   └── page.tsx       # Landing page
│   │   ├── components/
│   │   │   ├── ui/            # Button, Input, Card, Modal, Badge
│   │   │   ├── auction/       # BidPanel, AuctionTimer, BidHistory
│   │   │   ├── vehicle/       # VehicleCard, VehicleGallery, SpecsTable
│   │   │   └── layout/        # Navbar, Sidebar, Footer
│   │   ├── hooks/             # useAuth, useAuction, useWebSocket, useWallet
│   │   ├── lib/               # api client, socket client, utils
│   │   └── store/             # Zustand stores (auth, auction, wallet)
│   ├── public/
│   └── package.json
├── server/                    # Express.js Backend
│   ├── src/
│   │   ├── routes/            # auth, vehicles, auctions, wallet, valuation, admin
│   │   ├── middleware/        # auth, rbac, validation, errorHandler, rateLimiter
│   │   ├── services/          # auctionService, bidService, walletService, aiService
│   │   ├── models/            # SQL query builders per table
│   │   ├── socket/            # Socket.IO auction room handlers
│   │   ├── config/            # database pool, env validation
│   │   └── app.js
│   ├── migrations/            # SQL migration files (versioned)
│   ├── seeds/                 # Seed data (vehicle catalog, test users)
│   └── package.json
├── docker-compose.yml         # Local dev: PostgreSQL, app
├── .env.example
└── README.md</code></pre>
                        </div>
                    </div>

                    <!-- DEPLOYMENT -->
                    <div class="section" id="mvp-deploy">
                        <div class="section-header"><span class="label">Go-Live</span>
                            <h3>✅ Deployment Checklist</h3>
                        </div>
                        <div class="card">
                            <table>
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Item</th>
                                        <th>Status Needed</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>PostgreSQL provisioned on Render</td>
                                        <td>✅ connection string in env</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>All migrations run successfully</td>
                                        <td>✅ tables created, seeds loaded</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Paystack live keys configured</td>
                                        <td>✅ test transaction completed</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>Groq API key set</td>
                                        <td>✅ valuation returns result</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>Cloudinary configured</td>
                                        <td>✅ image upload/retrieve works</td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>Domain + SSL set up</td>
                                        <td>✅ HTTPS enforced everywhere</td>
                                    </tr>
                                    <tr>
                                        <td>7</td>
                                        <td>CORS configured for production domain</td>
                                        <td>✅ no wildcard origins</td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>JWT secrets rotated from dev values</td>
                                        <td>✅ unique production secrets</td>
                                    </tr>
                                    <tr>
                                        <td>9</td>
                                        <td>At least 10 vehicles in catalog</td>
                                        <td>✅ with images and specs</td>
                                    </tr>
                                    <tr>
                                        <td>10</td>
                                        <td>At least 1 test auction runs end-to-end</td>
                                        <td>✅ bid → win → settle</td>
                                    </tr>
                                    <tr>
                                        <td>11</td>
                                        <td>Admin account created</td>
                                        <td>✅ with strong password</td>
                                    </tr>
                                    <tr>
                                        <td>12</td>
                                        <td>Error monitoring connected (Sentry)</td>
                                        <td>✅ test error received</td>
                                    </tr>
                                    <tr>
                                        <td>13</td>
                                        <td>Backup strategy configured</td>
                                        <td>✅ daily PostgreSQL snapshots</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- SUCCESS CRITERIA -->
                    <div class="section" id="mvp-success">
                        <div class="section-header"><span class="label">Validation</span>
                            <h3>🏆 Success Criteria (Pass/Fail)</h3>
                        </div>
                        <div class="card-grid card-grid-2">
                            <div class="card" style="border-left:3px solid var(--success)">
                                <div class="card-title" style="color:var(--success)">Must Pass ✅</div>
                                <ul>
                                    <li>User can register, login, and fund wallet</li>
                                    <li>User can browse vehicles and view details</li>
                                    <li>AI valuation returns accurate pricing data</li>
                                    <li>User can join an auction and place real-time bids</li>
                                    <li>Winning bidder can complete payment</li>
                                    <li>Vehicle appears in winner's garage after settlement</li>
                                    <li>Admin can create auctions and view revenue</li>
                                    <li>Platform commission is automatically calculated and recorded</li>
                                    <li>No race conditions on concurrent bids</li>
                                    <li>WebSocket reconnects gracefully within 5 seconds</li>
                                </ul>
                            </div>
                            <div class="card" style="border-left:3px solid var(--warning)">
                                <div class="card-title" style="color:var(--warning)">Nice to Have 🟡</div>
                                <ul>
                                    <li>Page load time < 3 seconds on 3G</li>
                                    <li>AI valuation response time < 5 seconds</li>
                                    <li>Mobile layout looks good on all screen sizes</li>
                                    <li>Email notifications sent on key events</li>
                                    <li>Admin can export transaction data to CSV</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- TIMELINE -->
                    <div class="section" id="mvp-timeline">
                        <div class="section-header"><span class="label">Schedule</span>
                            <h3>📅 6-Week Development Timeline</h3>
                        </div>
                        <div class="card">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Week</th>
                                        <th>Focus</th>
                                        <th>Deliverables</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>1</strong></td>
                                        <td>Foundation</td>
                                        <td>Project setup, DB schema, migrations, auth (register/login/JWT), basic API
                                            structure</td>
                                    </tr>
                                    <tr>
                                        <td><strong>2</strong></td>
                                        <td>Vehicle Catalog</td>
                                        <td>Vehicle CRUD API, catalog seed data, browse page, detail page,
                                            search/filter, image upload</td>
                                    </tr>
                                    <tr>
                                        <td><strong>3</strong></td>
                                        <td>Auction Engine</td>
                                        <td>Auction CRUD, bidding API with row lock, Socket.IO rooms, live auction page,
                                            anti-sniping, AI reserve protection</td>
                                    </tr>
                                    <tr>
                                        <td><strong>4</strong></td>
                                        <td>Payments & Wallet</td>
                                        <td>Paystack integration, wallet funding/withdrawal, deposit hold on bid win,
                                            settlement flow, transaction history</td>
                                    </tr>
                                    <tr>
                                        <td><strong>5</strong></td>
                                        <td>Dashboard & AI</td>
                                        <td>User dashboard, garage page, bid history, profile/KYC, AI valuation (Groq
                                            integration), admin panel</td>
                                    </tr>
                                    <tr>
                                        <td><strong>6</strong></td>
                                        <td>Polish & Deploy</td>
                                        <td>Bug fixes, responsive design fixes, error handling, loading states,
                                            deployment, end-to-end testing, go-live</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="callout callout-info"><strong>Buffer:</strong> 1 additional week for unforeseen
                            issues. Total realistic timeline: <strong>6-7 weeks</strong>.</div>
                    </div>

                    <!-- POST-MVP -->
                    <div class="section" id="mvp-after">
                        <div class="section-header"><span class="label">Growth</span>
                            <h3>🗺️ Post-MVP Roadmap</h3>
                        </div>
                        <div class="card">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Phase</th>
                                        <th>Timeline</th>
                                        <th>Features</th>
                                        <th>Trigger</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Phase 2</strong></td>
                                        <td>Week 8-12</td>
                                        <td>Service marketplace, partner portal, phone OTP auth, push notifications, PWA
                                        </td>
                                        <td>First 50 completed auctions</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Phase 3</strong></td>
                                        <td>Week 13-18</td>
                                        <td>Concierge system, Redis caching, advanced analytics, multi-LLM failover</td>
                                        <td>100+ active users, >₦10M GMV</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Phase 4</strong></td>
                                        <td>Week 19-26</td>
                                        <td>3D garage, vector embeddings/recommendations, import orchestration,
                                            enterprise API</td>
                                        <td>500+ users, Series Seed secured</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Phase 5</strong></td>
                                        <td>Month 7+</td>
                                        <td>Telematics engine, government partnerships, insurance integration,
                                            multi-city expansion</td>
                                        <td>1000+ users, proven unit economics</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="card">
                            <div class="card-title">Key Principle</div>
                            <div class="callout callout-success"><strong>Ship → Measure → Iterate.</strong> Every
                                feature added post-MVP must be justified by user behavior data or direct revenue impact.
                                If users aren't asking for it and it doesn't move GMV — it doesn't get built.</div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Details</h3>
                <button class="modal-close" onclick="closeModal()">✕</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>


    <script>
        const NAV_DATA = {
            arch: {
                title: 'System Architecture & Core Workflows',
                sections: [
                    { id: 'arch-intro', label: 'Overview', icon: '🏠' },
                    { id: 'wf-1', label: 'WF1: Vehicle Discovery', icon: '🔍' },
                    { id: 'wf-2', label: 'WF2: Auction Bidding', icon: '🔨' },
                    { id: 'wf-3', label: 'WF3: Post-Auction Settlement', icon: '📋' },
                    { id: 'wf-4', label: 'WF4: Digital Garage', icon: '🏎️' },
                    { id: 'wf-5', label: 'WF5: Service Requests', icon: '🔧' },
                    { id: 'wf-6', label: 'WF6: Dealer Onboarding', icon: '🏢' },
                    { id: 'wf-7', label: 'WF7: Admin Operations', icon: '⚙️' },
                    { id: 'wf-8', label: 'WF8: Concierge Tasks', icon: '💬' },
                    { id: 'sys-identity', label: '1️⃣ Identity System', icon: '🔐' },
                    { id: 'sys-logic', label: '2️⃣ Business Logic', icon: '⚡' },
                    { id: 'sys-data', label: '3️⃣ Data Layer', icon: '🗄️' },
                    { id: 'sys-errors', label: '4️⃣ Error Handling', icon: '🛑' },
                    { id: 'sys-security', label: '5️⃣ Security', icon: '🛡️' },
                    { id: 'sys-deploy', label: '6️⃣ Deployment', icon: '🚀' },
                    { id: 'sys-ux', label: '7️⃣ UX Completion', icon: '📱' },
                ]
            },
            mvp: {
                title: 'MVP Prototype Recommendation',
                sections: [
                    { id: 'mvp-razor', label: 'The Razor', icon: '🎯' },
                    { id: 'mvp-scope', label: 'Scope: In vs Out', icon: '✂️' },
                    { id: 'mvp-arch', label: 'Architecture', icon: '🏗️' },
                    { id: 'mvp-data', label: 'Data Model', icon: '🗄️' },
                    { id: 'mvp-pages', label: 'MVP Pages', icon: '📄' },
                    { id: 'mvp-api', label: 'API Endpoints', icon: '🔌' },
                    { id: 'mvp-folder', label: 'Folder Structure', icon: '📁' },
                    { id: 'mvp-deploy', label: 'Deployment Checklist', icon: '✅' },
                    { id: 'mvp-success', label: 'Success Criteria', icon: '🏆' },
                    { id: 'mvp-timeline', label: 'Timeline', icon: '📅' },
                    { id: 'mvp-after', label: 'Post-MVP Roadmap', icon: '🗺️' },
                ]
            }
        };

        let currentDoc = 'arch';
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');

        function toggleSidebar() {
            const isOpen = sidebar.classList.toggle('open');
            overlay.classList.toggle('active', isOpen);
            document.body.style.overflow = isOpen ? 'hidden' : '';
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        function switchDoc(doc) {
            currentDoc = doc;
            document.querySelectorAll('.doc-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.doc-page').forEach(p => p.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('page-' + doc).classList.add('active');
            document.getElementById('topbarTitle').textContent = NAV_DATA[doc].title;
            renderNav(doc);
            // Scroll content to top when switching docs
            document.querySelector('.content').scrollTo(0, 0);
            window.scrollTo(0, 0);
        }

        function renderNav(doc) {
            const nav = document.getElementById('sidebarNav');
            nav.innerHTML = NAV_DATA[doc].sections.map(s =>
                `<a class="nav-link" onclick="scrollToSection('${s.id}')" data-section="${s.id}">
      <span class="icon">${s.icon}</span> ${s.label}
    </a>`
            ).join('');
        }

        function scrollToSection(id) {
            const el = document.getElementById(id);
            if (el) { el.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`[data-section="${id}"]`)?.classList.add('active');
            // Close sidebar on mobile after navigation
            closeSidebar();
        }

        function toggleWorkflow(el) {
            el.closest('.workflow-card').classList.toggle('open');
        }

        function openModal(title, contentId) {
            document.getElementById('modalTitle').textContent = title;
            const src = document.getElementById(contentId);
            document.getElementById('modalBody').innerHTML = src ? src.innerHTML : '';
            document.getElementById('modalOverlay').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('open');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                closeModal();
                closeSidebar();
            }
        });

        // Intersection observer for active nav highlight
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    document.querySelector(`[data-section="${entry.target.id}"]`)?.classList.add('active');
                }
            });
        }, { rootMargin: '-20% 0px -70% 0px' });

        // Wrap all standalone tables in scrollable container on load
        window.addEventListener('load', () => {
            renderNav('arch');
            document.querySelectorAll('[id^="wf-"],[id^="sys-"],[id^="mvp-"],[id^="arch-"]').forEach(el => observer.observe(el));

            // Wrap tables not already inside a .table-wrap for mobile horizontal scroll
            document.querySelectorAll('table').forEach(table => {
                if (!table.closest('.table-wrap')) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'table-wrap';
                    table.parentNode.insertBefore(wrapper, table);
                    wrapper.appendChild(table);
                }
            });
        });
    </script>

    <!-- CONTENT_INJECTION_POINT -->

</body>

</html>