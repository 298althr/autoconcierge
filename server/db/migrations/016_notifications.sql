-- Migration 016: Notifications System
CREATE TABLE IF NOT EXISTS notifications (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id     UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  title       VARCHAR(255) NOT NULL,
  message     TEXT NOT NULL,
  type        VARCHAR(50) NOT NULL, -- 'bid_outbid', 'auction_won', 'auction_lost', 'service_update', 'escrow_update'
  link        TEXT,                 -- URL or path to redirect user
  is_read     BOOLEAN DEFAULT false,
  metadata    JSONB DEFAULT '{}',   -- additional context like auction_id or vehicle_id
  created_at  TIMESTAMP DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id);
CREATE INDEX IF NOT EXISTS idx_notifications_is_read ON notifications(is_read);
